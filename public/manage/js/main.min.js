$(document).ready(function(){!function(){if(0!==$("input.fileupload").length){var e='<tr class="template-upload fade in"><td><span class="preview"><img width="46" height="80" src="${imgSrc_}"></span></td><td> <p class="name">${fileName_}</p>  </td><td>    <button class="btn btn-primary start">       <span>上传</span>    </button>    <button class="btn btn-warning cancel">       <span>取消</span>    </button>        </td></tr>',t={};$("input.fileupload").on("click",function(){t.id=$(this).parent().parent().parent().attr("id")}),$("input.fileupload").fileupload({autoUpload:!0,url:"/admin/product/"+t.id+"/image",dataType:"json",add:function(n,a){if(a.url="/admin/product/"+t.id+"/image",a.files&&a.files[0]){var i=$("input.fileupload").index(this),d=new FileReader;d.onload=function(n){t.src=n.target.result;var d=$.tmpl(e,{fileName_:a.files[0].name,fileSize_:(a.files[0].size/1e3).toFixed(2),imgSrc_:t.src}).appendTo(".files:eq("+i+")");a.content=d,$(".start",d).click(function(){t.bar=d,$("<p/>").text("上传中...").addClass("uploading").replaceAll($(this)),a.submit()}),$(".cancel",d).click(function(){$("<p/>").text("取消中...").replaceAll($(this)),a.abort(),$(d).remove()})},d.readAsDataURL(a.files[0])}},done:function(e,n){$(".uploading",n.content).text("上传成功");var a='<li><img src="'+t.src+'" alt=""></li>';$(this).parent().parent().siblings(".imglist").children().append(a)},progressall:function(e,n){var a=parseInt(100*(n.loaded/n.total),10);$(".bar",t.bar).css("width",a+"%")}})}}(),function(){var e=$("#score tbody").eq(0);0!==e.length&&(e.on("click","input.change",function(e){e.preventDefault();var t=$(this).parent().parent();t.find("input").removeAttr("disabled"),t.prev().find("input").removeAttr("disabled"),$(this).addClass("hidden").next().removeClass("hidden"),t.find("input.del").addClass("hidden").next().removeClass("hidden")}),e.on("click","input.del",function(e){e.preventDefault();var t=$(this).parent().parent(),n=t.attr("id");return n?($.ajax({url:"/admin/product/"+n,type:"DELETE"}).done(function(){$("#"+n).prev().remove(),$("#"+n).remove()}),void 0):t.prev().remove().end().remove()}),e.on("click","input.save",function(e){e.preventDefault();var t=$(this).parent().parent(),n=$("input.save").index(this);t.find("input").attr("disabled","disabled"),t.prev().find("input").attr("disabled","disabled"),$(this).addClass("hidden").prev().removeClass("hidden").removeAttr("disabled"),t.find("input.chanle").addClass("hidden").prev().removeClass("hidden").removeAttr("disabled");var a={id:t.attr("id"),price:$('input[name="price"').eq(n).val(),reservation_day:$('input[name="reservation_day"').eq(n).val(),inventory_per_day:$('input[name="inventory_per_day"').eq(n).val(),ignore_inventory:$('input[type="checkbox"').eq(n).prop("checked"),title:$('input[name="title"').eq(n).val(),description:$('input[name="description"').eq(n).val(),content:$('input[name="content"').eq(n).val(),rank:$('input[name="rank"').eq(n).val()};$.ajax({url:"/admin/product",type:"POST",dataType:"json",data:a,success:function(){location.reload()}})}),e.on("click","input.chanle",function(e){e.preventDefault();var t=$(this).parent().parent();t.find("input").attr("disabled","disabled"),t.prev().find("input").attr("disabled","disabled"),$(this).addClass("hidden").prev().removeClass("hidden").removeAttr("disabled"),t.find("input.save").addClass("hidden").prev().removeClass("hidden").removeAttr("disabled")}),$("#new").click(function(){e.find("tr:eq(1)").attr("id")&&(e.find("tr:eq(1)").clone(!0).prependTo(e),e.find("tr:eq(1)").clone(!0).prependTo(e),e.find('tr:eq(0) input[type="text"]').val(""),e.find("tr:eq(1)").removeAttr("id").find(".imglist").html(""))}),e.on("click",".imglist img",function(){var e=$(this);e.attr("id"),$.ajax({url:"/admin/product/"+e.parent().parent().parent().parent().attr("id")+"/image/"+e.attr("id"),type:"DELETE"}).done(function(){e.fadeOut(500,function(){e.remove()})})}))}(),function(){var e=$("div.wait");0!==e.length&&e.find("button.cOrder a").add("button.rOrder a").on("click",function(e){e.preventDefault(),$.get($(this).attr("href"),function(){location.reload()})})}(),function(){var e=$("#userManager")||0;0!==e.length&&$(".change").on("click",function(){var e=$(this),t=e.parent().prev().children(),n=e.parent().siblings().first().children().val();e.hasClass("saveChange")?(e.val("正在保存"),$("form.hidden").attr("action","user/"+n).children("input.real-balance").val(t.val()).end().submit()):(e.val("保存").addClass("saveChange"),t.removeAttr("disabled"))})}()});