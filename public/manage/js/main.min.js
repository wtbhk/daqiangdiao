$(document).ready(function(){!function(){if(0!==$("input.fileupload").length){var e='<tr class="template-upload fade in"><td><span class="preview"><img width="46" height="80" src="${imgSrc_}"></span></td><td> <p class="name">${fileName_}</p>  </td><td>    <button class="btn btn-primary start">       <span>上传</span>    </button>    <button class="btn btn-warning cancel">       <span>取消</span>    </button>        </td></tr>',n={};$("input.fileupload").on("click",function(){n.id=$(this).parent().parent().parent().attr("id")}),$("input.fileupload").fileupload({autoUpload:!0,url:"/admin/product/"+n.id+"/image",dataType:"json",add:function(t,a){if(a.url="/admin/product/"+n.id+"/image",a.files&&a.files[0]){var i=$("input.fileupload").index(this),d=new FileReader;d.onload=function(t){n.src=t.target.result;var d=$.tmpl(e,{fileName_:a.files[0].name,fileSize_:(a.files[0].size/1e3).toFixed(2),imgSrc_:n.src}).appendTo(".files:eq("+i+")");a.content=d,$(".start",d).click(function(){n.bar=d,$("<p/>").text("上传中...").addClass("uploading").replaceAll($(this)),a.submit()}),$(".cancel",d).click(function(){$("<p/>").text("取消中...").replaceAll($(this)),a.abort(),$(d).remove()})},d.readAsDataURL(a.files[0])}},done:function(e,t){$(".uploading",t.content).text("上传成功");var a='<li><img src="'+n.src+'" alt=""></li>';$(this).parent().parent().siblings(".imglist").children().append(a)},progressall:function(e,t){var a=parseInt(100*(t.loaded/t.total),10);$(".bar",n.bar).css("width",a+"%")}})}}(),function(){var e=$("#score tbody").eq(0);0!==e.length&&(e.on("click","input.change",function(e){e.preventDefault();var n=$(this).parent().parent();n.find("input").removeAttr("disabled"),n.prev().find("input").removeAttr("disabled"),$(this).addClass("hidden").next().removeClass("hidden"),n.find("input.del").addClass("hidden").next().removeClass("hidden")}),e.on("click","input.del",function(e){e.preventDefault();var n=$(this).parent().parent(),t=n.attr("id");return t?($.ajax({url:"/admin/product/"+t,type:"DELETE"}).done(function(){$("#"+t).prev().remove(),$("#"+t).remove()}),void 0):n.prev().remove().end().remove()}),e.on("click","input.save",function(e){e.preventDefault();var n=$(this).parent().parent(),t=$("input.save").index(this);n.find("input").attr("disabled","disabled"),n.prev().find("input").attr("disabled","disabled"),$(this).addClass("hidden").prev().removeClass("hidden").removeAttr("disabled"),n.find("input.chanle").addClass("hidden").prev().removeClass("hidden").removeAttr("disabled");var a={id:n.attr("id"),price:$('input[name="price"').eq(t).val(),reservation_day:$('input[name="reservation_day"').eq(t).val(),inventory_per_day:$('input[name="inventory_per_day"').eq(t).val(),ignore_inventory:$('input[type="checkbox"').eq(t).prop("checked"),title:$('input[name="title"').eq(t).val(),description:$('input[name="description"').eq(t).val(),content:$('input[name="content"').eq(t).val(),available:$('input[name="available"').eq(t).prop("checked"),rank:$('input[name="rank"').eq(t).val()};$.ajax({url:"/admin/product",type:"POST",dataType:"json",data:a,success:function(){location.reload()}})}),e.on("click","input.chanle",function(e){e.preventDefault();var n=$(this).parent().parent();n.find("input").attr("disabled","disabled"),n.prev().find("input").attr("disabled","disabled"),$(this).addClass("hidden").prev().removeClass("hidden").removeAttr("disabled"),n.find("input.save").addClass("hidden").prev().removeClass("hidden").removeAttr("disabled")}),$("#new").click(function(){e.find("tr:eq(1)").attr("id")&&(e.find("tr:eq(1)").clone(!0).prependTo(e),e.find("tr:eq(1)").clone(!0).prependTo(e),e.find('tr:eq(0) input[type="text"]').val(""),e.find("tr:eq(1)").removeAttr("id").find(".imglist").html(""))}),e.on("click",".imglist img",function(){var e=$(this);e.attr("id"),$.ajax({url:"/admin/product/"+e.parent().parent().parent().parent().attr("id")+"/image/"+e.attr("id"),type:"DELETE"}).done(function(){e.fadeOut(500,function(){e.remove()})})}))}(),function(){var e=$("div.wait");0!==e.length&&e.find("button.cOrder a").add("button.rOrder a").on("click",function(e){e.preventDefault(),$.get($(this).attr("href"),function(){location.reload()})})}(),function(){var e=$("#userManager")||0;0!==e.length&&$(".change").on("click",function(){var e=$(this),n=e.parent().prev().children(),t=e.parent().siblings().first().children().val();e.hasClass("saveChange")?(e.val("正在保存"),$("form.hidden").attr("action","user/"+t).children("input.real-balance").val(n.val()).end().submit()):(e.val("保存").addClass("saveChange"),n.removeAttr("disabled"))})}(),function(){var e=$("#chefManager");0!==e.length&&$(".change").on("click",function(){var e=$(this),n=e.parent().parent(),t=n.find("input.id"),a=n.find("input.name"),i=n.find("input.phone"),d=n.find("input.profile"),r=n.find("input.rank");e.hasClass("saveChange")?(e.text("正在保存"),$("form.hidden").children('input[name="id"]').val(t.val()).end().children('input[name="name"]').val(a.val()).end().children('input[name="profile"]').val(d.val()).end().children('input[name="rank"]').val(r.val()).end().children('input[name="phone"]').val(i.val()).end().submit()):(e.text("保存").addClass("saveChange"),n.find('input[class!="id"]').removeAttr("disabled"))})}()});